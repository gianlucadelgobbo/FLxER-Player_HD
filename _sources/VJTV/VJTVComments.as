package VJTV {	import flash.display.Sprite;	import flash.display.Loader;	import flash.net.URLRequest;	import flash.events.*;	import FLxER.main.Rett;	import FLxER.main.Txt;	import FLxER.comp.ButtonTxt;	import VJTV.VJTVCommList;	import VJTV.Scroller;	import tbtv.juventusmember.JuveApi;	public class VJTVComments extends Sprite {		var myMask:Rett;		var cnt:Sprite;		var listSprites:Array;		var myScroll:Scroller;		var listTit:Txt;		var pages:Txt;		var commTit:Txt;		var commBox:Txt;		var imgLoader:Loader;		var postID:uint;		var commBoxButton:ButtonTxt;		var commBoxTit:Txt;		var last_page,nextPage,prevPage;		public function VJTVComments():void {			listSprites = new Array();			listTit = new Txt(7, 35, 450, 22, " ", Preferences.pref.th, "");			this.addChild(listTit);			pages = new Txt(10, 265, 450, 11, "0 of 0 PAGINE",Preferences.pref.ts, "html");			this.addChild(pages);			myMask = new Rett(10, 60, 430, 200, 0x000000, -1, .5);			this.addChild(myMask);			nextPage = new ButtonTxt(460-70, 265, 70, 13, "AVANTI", pager, 1, "");			this.addChild(nextPage);			prevPage = new ButtonTxt(460-150, 265, 70, 13, "INDIETRO", pager, -1, "");			this.addChild(prevPage);			cnt = new Sprite();			cnt.x = 10;			cnt.y = 60;			this.addChild(cnt);			cnt.mask = myMask;			commTit = new Txt(475, 35, 450, 22, " ", Preferences.pref.th, "");			this.addChild(commTit);			commTxt = new Txt(475, 55, 450, 22, " ", Preferences.pref.ts, "html");			this.addChild(commTxt);			commBoxTit = new Txt(541, 70, 385, 20, "Scrivi un commento", Preferences.pref.th, "");			this.addChild(commBoxTit);			commBox = new Txt(545, 95, 385, 110, "", Preferences.pref.ts, "input", saveComm);			this.addChild(commBox);			commBoxButton = new ButtonTxt(930-50, 210, 50, 13, "INVIA", saveCommFake, "1", "");			this.addChild(commBoxButton);			imgLoader = new Loader();			/*imgLoader.contentLoaderInfo.addEventListener(Event.INIT, initHandlerSWF);			imgLoader.contentLoaderInfo.addEventListener(SecurityErrorEvent.SECURITY_ERROR, errorHandlerSWF);			imgLoader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, errorHandlerSWF);*/			this.addChild(imgLoader);			imgLoader.x = 480;			imgLoader.y = 75;			rateTit = new Txt(475, 35, 450, 22, " ", Preferences.pref.th, "");			//this.addChild(rateTit);		}		public function setPost(xml):void {		}		public function pager(p):void {			parent.pager(parseInt(p),last_page);		}		public function saveComm(t:String):void {			trace("videoPlayerContentCommentAdd comment:"+t+" content_id:"+postID)			var api:JuveApi = new JuveApi(getSession, Preferences.pref.sessionId, true);			api.setAction("videoPlayerContentCommentAdd");			api.addParam("content_id", postID);			api.addParam("comment", t);			api.run();		}		function saveCommFake(e):void {			saveComm(commBox.text)		}		function getSession(e):void {			parent.api.run();			trace("========"+e);		}		public function updatePage(e,xml):void {			postID = xml.attributes.id;			trace("setPost " + xml.childNodes[1].childNodes[0].childNodes[0]);			trace("setPost " + xml.childNodes[1].childNodes[3].childNodes[0]);				Preferences.pref.interfaceTrgt.myloaded = true;				Preferences.pref.interfaceTrgt.stopLoading();			//postID = e;			commTit.text = xml.childNodes[1].childNodes[0].childNodes[0];			commTxt.text = xml.childNodes[1].childNodes[3].childNodes[0];					listTit.text = xml.childNodes[1].childNodes[0].childNodes[0];			rateTit.text = "Vota "+xml.childNodes[1].childNodes[0].childNodes[0];			pages.htmlText = "Pagina "+e.message.current_page+" di "+e.message.last_page;			last_page = e.message.last_page;			/*pages.htmlText = Preferences.myReplace(xml.childNodes[0].childNodes[3].toString(),"href=\"","href=\"event:");			pages.addEventListener(TextEvent.LINK, linkEvent);*/			imgLoader.load(new URLRequest(Preferences.pref.userImg_small));			var b=0;			trace(e)			for (var c=0;c<listSprites.length;c++) {				cnt.removeChild(listSprites[c]);			}			listSprites = new Array();			for (var a in e.message.rows) {				listSprites.push(new VJTVCommList(0, (b>0 ? listSprites[b-1].y+listSprites[b-1].height+10 : 0), 400, e.message.rows[a]));				cnt.addChild(listSprites[b]);				b++			}			myScroll = new Scroller(myMask, cnt);			this.addChild(myScroll);			myScroll.avvia(myMask, cnt)			setPos()		}		public function setPos():void {			commTxt.height = commTxt.textHeight;			imgLoader.y = commBoxTit.y = commTxt.y+commTxt.height+10;			commBox.y = commBoxTit.y+20;			commBoxButton.y = commBox.height+commBox.y+5;			rateTit.y = commBoxButton.y+10;		}		public function linkEvent(event:TextEvent):void {			//fnzCanal(event.text); // Link Clicked		}	}}